
var canvas,ctx,randomId,points={},webDraft={title:"WebDraft",version:"2.2.6",click:{left:false,right:false},mPosition:{x:0,y:0},draw:{width:600,height:600,thisParent:"#drawHandler",selectorId:"#draw",eventHandler:"#eventHandler",bg:"url('pic/transparent.png') repeat"},shadow:{isShadow:false,blur:1,offsetX:0,offsetY:0,color:"#232324"},sensitivityPoints:1000,size:10,color:"#000000",selectedTool:"pencil",func:{makeid:function(){var c="";var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var b=0;b<15;b++){c+=a.charAt(Math.floor(Math.random()*a.length))}return c},resize:function(){},positionElements:function(){var c={id:new Array(),img:new Array()};var b=layers.activeId;for(var a=0;a<layers.list.length;a++){if(typeof layers.list[a].id==="string"){layers.select(layers.list[a].id);c.img[a]=ctx.getImageData(0,0,webDraft.draw.width,webDraft.draw.height);c.id[a]=layers.list[a].id}}$(webDraft.draw.selectorId+","+webDraft.draw.eventHandler).css({width:webDraft.draw.width,height:webDraft.draw.height});$(webDraft.draw.thisParent).css({background:webDraft.draw.bg,width:webDraft.draw.width,height:webDraft.draw.height});if(webDraft.draw.width>=$("#content").width()){$(webDraft.draw.thisParent).css({"margin-left":"0px"})}else{$(webDraft.draw.thisParent).css({"margin-left":($("#content").width()-webDraft.draw.width)/2})}if(webDraft.draw.height>=$("#content").height()){$(webDraft.draw.thisParent).css({"margin-top":"0px"})}else{$(webDraft.draw.thisParent).css({"margin-top":($("#content").height()-webDraft.draw.height)/2})}for(var a=0;a<layers.list.length;a++){if(typeof layers.list[a].id==="string"){layers.select(layers.list[a].id);ctx.putImageData(c.img[a],0,0);layers.saveState()}}if(b!==""){layers.select(b)}$("title").text(webDraft.title+" v"+webDraft.version+" ["+webDraft.draw.width+" x "+webDraft.draw.height+"]");$("html, body, #paint").css({visibility:"visible"})},moveEraseRect:function(a){$("#eraseRect").css({width:webDraft.size,height:webDraft.size,top:a.pageY-(webDraft.size/2)+"px",left:a.pageX-(webDraft.size/2)+"px"})},erase:function(a){webDraft.func.moveEraseRect(a);ctx.clearRect(webDraft.mPosition.x-webDraft.size/2,webDraft.mPosition.y-webDraft.size/2,webDraft.size,webDraft.size);points[layers.activeId]=[]},colorsampler:function(d){var l=webDraft.mPosition.x;var i=webDraft.mPosition.y;var e=ctx.getImageData(l,i,1,1).data;var m;var c=e[0];var h=e[1];var j=e[2];var f=e[3];var k=Math.floor((100*f)/255)/100;if(k<=0){m=((c<<16)|(h<<8)|j).toString(16)}else{m="rgba("+c+","+h+","+j+","+k+")"}if(m==="0"){m="transparent"}$("#textColorSampler").text(m);$("#colorBoxSampler").css({"background-color":m})},colorsamplerSetcolor:function(){if($("#textColorSampler").text()!=="null"){$("#generalColor .color").css({background:$("#textColorSampler").text()});$("#firstColor").val($("#textColorSampler").text());webDraft.color=$("#textColorSampler").text()}},mousePosition:function(c){var d=undefined;if(c.originalEvent.touches){d=c.originalEvent.touches[0];var b=c.pageX||d.pageX;var a=c.pageY||d.pageY}else{var b=c.pageX;var a=c.pageY}webDraft.mPosition.x=b-parseInt($(webDraft.draw.selectorId).offset().left);webDraft.mPosition.y=a-parseInt($(webDraft.draw.selectorId).offset().top);webDraft.mPosition.y=webDraft.mPosition.y-parseInt($(canvas).css("top"));webDraft.mPosition.x=webDraft.mPosition.x-parseInt($(canvas).css("left"));$("#mousePosition").text(webDraft.mPosition.x+" , "+webDraft.mPosition.y);if(webDraft.mPosition.x<0||webDraft.mPosition.x>$(webDraft.draw.selectorId).width()||webDraft.mPosition.y<0||webDraft.mPosition.y>$(webDraft.draw.selectorId).height()){$("#mousePosition").empty()}},_mousedown:function(b){webDraft.func.mousePosition(b);if("buttons" in b){if(b.buttons==1){webDraft.click.left=true}}var a=b.which||b.button;if(a==1){webDraft.click.left=true}if(!webDraft.click.right&&webDraft.click.left){if(webDraft.selectedTool!=="select"){points[layers.activeId].push({x:webDraft.mPosition.x,y:webDraft.mPosition.y})}switch(webDraft.selectedTool){case"pencil":case"eraser":draw.drawing();break;case"select":select.initSelect();break;case"rectangle":shapes.startShape();break;case"circle":shapes.startShape();break;case"text":text.initSelect();break;case"colorsampler":webDraft.func.colorsamplerSetcolor();$("#pencil").click();break}}},_mouseup:function(a){webDraft.click.left=false;webDraft.click.right=false;ctx.beginPath();ctx.stroke();switch(webDraft.selectedTool){case"select":select.selectOpt();break;case"text":text.showTextOptions();break;case"rectangle":shapes.drawRect();break;case"circle":shapes.drawCircle();break}layers.saveState()},_mousemove:function(a){webDraft.func.mousePosition(a);switch(webDraft.selectedTool){case"eraser":webDraft.func.moveEraseRect(a);break;case"colorsampler":webDraft.func.colorsampler();break;case"select":if(!select.isSelecting&&webDraft.mPosition.x<=parseInt($("#selectRectangle").css("left"))+$("#selectRectangle").width()&&webDraft.mPosition.x>=parseInt($("#selectRectangle").css("left"))&&webDraft.mPosition.y<=parseInt($("#selectRectangle").css("top"))+$("#selectRectangle").height()&&webDraft.mPosition.y>=parseInt($("#selectRectangle").css("top"))){select.hoverSelectRectangle=true;$("#selectRectangle").css({"z-index":5})}else{select.hoverSelectRectangle=false;$("#selectRectangle").css({"z-index":3})}break;case"text":if(!text.isSelecting&&webDraft.mPosition.x<=parseInt($("#textRectangle").css("left"))+$("#textRectangle").width()&&webDraft.mPosition.x>=parseInt($("#textRectangle").css("left"))&&webDraft.mPosition.y<=parseInt($("#textRectangle").css("top"))+$("#textRectangle").height()&&webDraft.mPosition.y>=parseInt($("#textRectangle").css("top"))){text.hoverSelectRectangle=true;$("#textRectangle").css({"z-index":5})}else{text.hoverSelectRectangle=false;$("#textRectangle").css({"z-index":3})}break}if(webDraft.click.left&&!webDraft.click.right){if(webDraft.selectedTool!=="select"){points[layers.activeId].push({x:webDraft.mPosition.x,y:webDraft.mPosition.y})}switch(webDraft.selectedTool){case"pencil":case"eraser":draw.drawStyle();ctx.lineTo(webDraft.mPosition.x,webDraft.mPosition.y);ctx.stroke();break;case"web":draw.drawWeb();break;case"select":if(!select.hoverSelectRectangle){select.startSelect()}break;case"text":if(!text.hoverSelectRectangle){text.startSelect()}break;case"rectangle":shapes.prepareRect();break;case"circle":shapes.prepareCircle();break}}},init:function(){text.initEvents();layers.initEvents();layers.newLayer();$(webDraft.draw.eventHandler).hover(function(){ctx.beginPath();ctx.stroke();if(webDraft.selectedTool==="eraser"){$("#eraseRect").show()}}).bind("contextmenu",function(a){a.preventDefault();webDraft.click.right=true;webDraft.click.left=false}).on("mousedown touchstart",webDraft.func._mousedown).on("mouseup touchend",webDraft.func._mouseup).on("mousemove touchmove",webDraft.func._mousemove).mouseleave(function(){ctx.stroke();layers.saveState();if(webDraft.selectedTool==="eraser"){$("#eraseRect").hide()}}).dblclick(function(){switch(webDraft.selectedTool){case"select":$("#selectRectangle").css({top:"0px",left:"0px"}).width(0).height(0).hide();break;case"text":text.putLayer();break}})}}};function hexToRgba(j,f){j=j.replace("#","");var i=parseInt(j.substring(0,2),16);var h=parseInt(j.substring(2,4),16);var d=parseInt(j.substring(4,6),16);var e=f/100;var c="rgba("+i+","+h+","+d+","+e+")";return c}$(window).resize(function(){webDraft.func.resize();webDraft.func.positionElements()});$(document).ready(function(a){if(/mobile/i.test(navigator.userAgent)){webDraft.draw.width=window.innerWidth-10;webDraft.draw.height=window.innerHeight-30}webDraft.func.init();$("#resizer").draggable({snap:true,opacity:0.75}).css({position:"absolute"});$("#selectRectangle, #textRectangle").draggable({snap:false}).css({position:"absolute"});$("#shadowDot").draggable({containment:"#shadowSquare",scroll:false,drag:function(){var c=parseInt($(this).css("top"))-(parseInt($(this).parent().height())/2);var b=parseInt($(this).css("left"))-(parseInt($(this).parent().width())/2);webDraft.shadow.offsetX=b;webDraft.shadow.offsetY=c}});$("#shadowSquare").on("mousedown",function(d){var c=d.pageX-$(this).offset().left;var g=d.pageY-$(this).offset().top;$("#shadowDot").css({top:(g-5)+"px",left:(c-5)+"px"});var f=parseInt($("#shadowDot").css("top"))-(parseInt($("#shadowDot").parent().height())/2);var b=parseInt($("#shadowDot").css("left"))-(parseInt($("#shadowDot").parent().width())/2);webDraft.shadow.offsetX=b;webDraft.shadow.offsetY=f});$(".close-info").click(function(){$("#info").hide()});$("#btnSave").click(function(){file.download()});$(".paintTool").click(function(){$(".paintTool").removeClass("active");$(this).addClass("active");var b=$(this).attr("id");webDraft.selectedTool=b;if(b==="colorsampler"){$("#previewColorSampler").show()}else{$("#previewColorSampler").hide()}if(b==="web"){$("#sensitivityPoints_slider").show()}else{$("#sensitivityPoints_slider").hide()}if(b==="eraser"){$("#eraseRect").show();$("#draw, #drawHandler, #eventHandler").css({cursor:"none"})}else{$("#eraseRect").hide();$("#draw, #drawHandler, #eventHandler").css({cursor:"crosshair"})}if(b!=="rectangle"){$("#prepareRect").hide()}if(b!=="circle"){$("#prepareCircle").hide()}if(b!=="select"){$("#selectRectangle").hide();$("#hint, .hintGroup#selecting").hide()}else{$("#hint, .hintGroup#selecting").show()}if(b!=="text"){$("#textRectangle, #textOptions").hide()}if(b==="rectangle"||b==="circle"){$("#fillShapeInput").show()}else{$("#fillShapeInput").hide();$("input#isFillSet").attr("checked",false).change()}});$("#fileUploader").click(function(){$("input#fileUploaderInput").click()});$("#resizeDraw").click(function(){$("#resizer").fadeIn();$("input[type=number]#drawWidth").val(webDraft.draw.width);$("input[type=number]#drawHeight").val(webDraft.draw.height);$("#resizeinfo").html(webDraft.draw.width+" <i class='fa fa-times'></i> "+webDraft.draw.height)});$("#cancel").click(function(){$("#resizer").fadeOut();$("input[type=number]#drawWidth").val(webDraft.draw.width);$("input[type=number]#drawHeight").val(webDraft.draw.height)});$("#apply").click(function(){$("#resizer").fadeOut();if($("#allLayersResizing").is(":checked")){layers.setLayerSize("",webDraft.draw.width,webDraft.draw.height)}else{var b=$("input[type=number]#drawWidth").val(),c=$("input[type=number]#drawHeight").val();layers.setLayerSize(layers.activeId,b,c)}webDraft.func.positionElements()});$("#btnCLear").click(function(){$(webDraft.draw.selectorId).empty();$("#listLayers").empty();points={};webDraft.func.init()});$("input[type=range]#pointSize").on("mousemove touchmove",function(){webDraft.size=$(this).val();$("#pointSizeValue").text("size:"+$(this).val()+"px")});$("input[type=range]#ShadowBlur").on("mousemove touchmove",function(){webDraft.shadow.blur=$(this).val();$("#ShadowBlurValue").text("shadow:"+$(this).val()+"px")});$("input[type=range]#sensitivityPoints").on("mousemove touchmove",function(){webDraft.sensitivityPoints=$(this).val();$("#sensitivityPointsValue").text("sensitivity:"+Math.floor($(this).val()/100)+"%")});$("input[type=range]#fillOpacity").on("mousemove touchmove",function(){shapes.fill.opacity=$(this).val();$("#fillOpacityValue").text("fill opacity:"+Math.floor($(this).val())+"%")});$("#generalColor").click(function(){$("input[type=color]#firstColor").click()});$("#shadowColor").click(function(){$("input[type=color]#shadowColorVal").click()});$("#fillColor").click(function(){$("input[type=color]#fillColorVal").click()});$("input[type=color]#firstColor").change(function(){$("#generalColor .color").css({background:$(this).val()});webDraft.color=$(this).val();$("#textRectangle").css("color",$(this).val())});$("input[type=color]#shadowColorVal").change(function(){$("#shadowColor .color").css({background:$(this).val()});webDraft.shadow.color=$(this).val()});$("input[type=color]#fillColorVal").change(function(){$("#fillColor .color").css({background:$(this).val()});shapes.fill.color=$(this).val()});$("#resizer input[type=number]").change(function(){var c=parseInt($("input[type=number]#drawWidth").val());var b=parseInt($("input[type=number]#drawHeight").val());$("#resizeinfo").html(c+" <i class='fa fa-times'></i> "+b)}).keyup(function(b){$(this).change();if(b.keyCode===13){$("#apply").click()}else{if(b.keyCode===27){$("#cancel").click()}}});$("input[type=checkbox]#isShadow").change(function(){webDraft.shadow.isShadow=$(this).is(":checked");if(webDraft.shadow.isShadow){$("#shadowColor, #shadow_slider, #shadowSquare").show()}else{$("#shadowColor, #shadow_slider, #shadowSquare").hide()}});$("input[type=checkbox]#isFillSet").change(function(){shapes.fill.isSet=$(this).is(":checked");if(shapes.fill.isSet){$("#fillColor, #fillOpacity_slider").show()}else{$("#fillColor, #fillOpacity_slider").hide()}})}).bind("contextmenu",function(a){a.preventDefault()}).on("mouseup touchend",webDraft.func._mouseup).on("mousemove touchmove",webDraft.func._mousemove);