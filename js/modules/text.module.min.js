
var text={hoverSelectRectangle:false,isSelecting:false,startSelectPoints:[0,0],initSelect:function(){text.startTextPoints=[webDraft.mPosition.x,webDraft.mPosition.y]},startSelect:function(){if($("#textRectangle").empty()){if(text.startTextPoints[0]<=webDraft.mPosition.x){var b=text.startTextPoints[0],c=webDraft.mPosition.x-text.startTextPoints[0]}else{var b=webDraft.mPosition.x,c=text.startTextPoints[0]-webDraft.mPosition.x}if(text.startTextPoints[1]<=webDraft.mPosition.y){var d=text.startTextPoints[1],a=webDraft.mPosition.y-text.startTextPoints[1]}else{var d=webDraft.mPosition.y,a=text.startTextPoints[1]-webDraft.mPosition.y}$("#textRectangle").empty().show().css({top:d+"px",left:b+"px","min-height":a+"px",width:c+"px",height:a+"px",border:"1px dashed #fff",background:"transparent"});text.isSelecting=true}},showTextOptions:function(){text.isSelecting=false;$("#textOptions").show()},putLayer:function(){$("#textRectangle").css("border","none");if($("#textRectangle").html()===""){return false}var b=parseInt($("#textRectangle").css("top"));var a=parseInt($("#textRectangle").css("left"));html2canvas($("#textRectangle"),{onrendered:function(c){var d=c.width;var e=c.height;layers.newLayer();layers.setLayerSize(layers.activeId,d,e);layers.setLayerPosition(layers.activeId,b,a);webDraft.func.positionElements();ctx.drawImage(c,0,0);layers.saveState();$("#textRectangle").css({top:"0px",left:"0px",border:"1px dashed rgb(255, 255, 255)"}).width(0).height(0).hide().empty()}})},initEvents:function(){$("#selectFontType").change(function(){$("#textRectangle").css("font-family",$(this).val())});$("#selectFontSize").change(function(){$("#textRectangle").css("font-size",$(this).val()+"px")});$(".textPostionTool").click(function(){$(".textPostionTool").removeClass("active");$(this).addClass("active");$("#textRectangle").css("text-align",$(this).attr("id"))});$(".styleTool").click(function(){$(this).toggleClass("active");switch($(this).attr("id")){case"bold":if($(this).hasClass("active")){$("#textRectangle").css("font-weight","bold")}else{$("#textRectangle").css("font-weight","normal")}break;case"italic":if($(this).hasClass("active")){$("#textRectangle").css("font-style","italic")}else{$("#textRectangle").css("font-style","normal")}break;case"underline":case"line-through":var a="";$(".textDecoration.active").each(function(){a+=$(this).attr("id")+" "});if($(".textDecoration.active").length>0){$("#textRectangle").css("text-decoration",a)}else{$("#textRectangle").css("text-decoration","none")}break;default:}})}};